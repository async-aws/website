<!DOCTYPE html><html lang="en"><head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="/assets/0.22a6512e.css"><link rel="stylesheet" href="/assets/app.c3007eb6.css">

    <title>AsyncAWS</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-72201185-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-72201185-3');
    </script>
</head>
<body>
<div class="d-flex">
    <nav id="sidebar" class="sidebar">
        <div class="custom-menu-toggle">
            <button type="button" id="sidebarCollapse" class="btn btn-primary">
                ☰
                <span class="sr-only">Toggle Menu</span>
            </button>
        </div>
        <div class="p-4 pt-1">
            <a href="/" class="logo mx-auto d-block">
                <img src="/assets/image/logo.8de63200.png" alt="AsyncAws logo">
            </a>
            <ul class="list-unstyled p-0 mb-5">

                                                                <li>
                        <a href="/">
                            Start
                        </a>
                    </li>
                                    <li>
                        <a href="/compare.html">
                            Compare with AWS
                        </a>
                    </li>
                                    <li>
                        <a href="/configuration.html">
                            Configuration
                        </a>
                    </li>
                                                                                <li>
                    <a href="javascript:void(0)" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Api clients</a>
                    <ul class="collapse list-unstyled " id="clients">
                                                    <li>
                        <a href="/clients/">
                            Overview
                        </a>
                    </li>
                                    <li>
                        <a href="/clients/cf.html">
                            Cloud Formation
                        </a>
                    </li>
                                    <li>
                        <a href="/clients/dynamodb.html">
                            DynamoDB
                        </a>
                    </li>
                                    <li>
                        <a href="/clients/lambda.html">
                            Lambda
                        </a>
                    </li>
                                    <li>
                        <a href="/clients/s3.html">
                            S3
                        </a>
                    </li>
                                    <li>
                        <a href="/clients/ses.html">
                            SES
                        </a>
                    </li>
                                    <li>
                        <a href="/clients/sns.html">
                            SNS
                        </a>
                    </li>
                                    <li>
                        <a href="/clients/sqs.html">
                            SQS
                        </a>
                    </li>
                                    <li>
                        <a href="/clients/sts.html">
                            STS
                        </a>
                    </li>
                                                        </ul>
                </li>
                                                            <li>
                    <a href="javascript:void(0)" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Features</a>
                    <ul class="collapse list-unstyled show" id="features">
                                                    <li class="current">
                        <a href="/features/async.html">
                            Why "async"?
                        </a>
                    </li>
                                    <li>
                        <a href="/features/pagination.html">
                            Pagination
                        </a>
                    </li>
                                    <li>
                        <a href="/features/presign.html">
                            Presign requests
                        </a>
                    </li>
                                    <li>
                        <a href="/features/waiter.html">
                            Waiters
                        </a>
                    </li>
                                    <li>
                        <a href="/features/tests.html">
                            Writing tests
                        </a>
                    </li>
                                                        </ul>
                </li>
                                                            <li>
                    <a href="javascript:void(0)" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Integration</a>
                    <ul class="collapse list-unstyled " id="integration">
                                                    <li>
                        <a href="/integration/symfony-bundle.html">
                            Symfony Bundle
                        </a>
                    </li>
                                    <li>
                        <a href="/integration/flysystem.html">
                            Flysystem
                        </a>
                    </li>
                                                        </ul>
                </li>
                                                            <li>
                    <a href="javascript:void(0)" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Authentication</a>
                    <ul class="collapse list-unstyled " id="authentication">
                                                    <li>
                        <a href="/authentication/">
                            Overview
                        </a>
                    </li>
                                    <li>
                        <a href="/authentication/credentials-file.html">
                            Credentials file
                        </a>
                    </li>
                                    <li>
                        <a href="/authentication/ec2-metadata.html">
                            EC2 instance metadata
                        </a>
                    </li>
                                    <li>
                        <a href="/authentication/environment.html">
                            Environment variables
                        </a>
                    </li>
                                    <li>
                        <a href="/authentication/hard-coded.html">
                            Hard-Coded values
                        </a>
                    </li>
                                    <li>
                        <a href="/authentication/web-identity.html">
                            WebIdentity
                        </a>
                    </li>
                                                        </ul>
                </li>
                                                            <li>
                    <a href="javascript:void(0)" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Contribute</a>
                    <ul class="collapse list-unstyled " id="contribute">
                                                    <li>
                        <a href="/contribute/">
                            Introduction
                        </a>
                    </li>
                                    <li>
                        <a href="/contribute/website.html">
                            Documentation
                        </a>
                    </li>
                                    <li>
                        <a href="/contribute/generate.html">
                            Generate code
                        </a>
                    </li>
                                                        </ul>
                </li>
                                                                                <li>
                        <a href="https://github.com/async-aws/aws">
                            Github
                        </a>
                    </li>
                                                            </ul>

            <p class="created-by">
                Async AWS is created by <br>
                <a href="https://github.com/jderusse">Jérémy Derussé</a>,
                <a href="https://github.com/Nyholm">Tobias Nyholm</a> <br>
                and <a href="https://github.com/async-aws/aws/graphs/contributors">contributors</a>.
            </p>

            <p class="copyright mt-5">
                Copyright © 2020<br>
                Project licensed under MIT
            </p>
        </div>
    </nav>

    <main role="main" id="content" class="content p-4 p-md-5 pt-5">
    <a href="https://github.com/async-aws/aws" class="contribute" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
    <div class="contribute-badge">Contribute</div>
</a>
    
    <h1 id="how-to-work-asynchronous">How to work asynchronous</h1>
<p>Asynchronous stuff can be confusing and because of that it is normal to try to stay
away from it. But hopefully, using this library will straight forward. The goal is
to always be "async first" but developers don't have to care about async if they
don't want to.</p>
<h2 id="normal-use-cases">Normal use cases</h2>
<p>Let's show some examples to better understand how this library works.</p>
<h3 id="ignoring-results">Ignoring results</h3>
<p>Consider the following example:</p>
<pre><code class="language-php hljs"><span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Sqs</span>\<span class="hljs-title">SqsClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Sqs</span>\<span class="hljs-title">Input</span>\<span class="hljs-title">SendMessageRequest</span>;

$sqs = <span class="hljs-keyword">new</span> SqsClient();

$input = <span class="hljs-keyword">new</span> SendMessageRequest();
$input
    -&gt;setQueueUrl(<span class="hljs-string">'https://sqs.us-east-2.amazonaws.com/123456789012/invoice'</span>)
    -&gt;setMessageBody(<span class="hljs-string">'invoiceId: 1337'</span>);

$sqs-&gt;sendMessage($input);</code></pre>
<p>The HTTP request is sent and a HTTP response is received. Everything works as expected.</p>
<p>A small bonus is that the full HTTP response is not downloaded. Only the first line
with the status code is fetched from the server.</p>
<h3 id="getting-data-from-result">Getting data from result</h3>
<p>The example below is slightly different.</p>
<pre><code class="language-php hljs"><span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Sqs</span>\<span class="hljs-title">SqsClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Sqs</span>\<span class="hljs-title">Input</span>\<span class="hljs-title">SendMessageRequest</span>;

$sqs = <span class="hljs-keyword">new</span> SqsClient();

$input = <span class="hljs-keyword">new</span> SendMessageRequest();
$input
    -&gt;setQueueUrl(<span class="hljs-string">'https://sqs.us-east-2.amazonaws.com/123456789012/invoice'</span>)
    -&gt;setMessageBody(<span class="hljs-string">'invoiceId: 1337'</span>);

$result = $sqs-&gt;sendMessage($input);

<span class="hljs-keyword">echo</span> $result-&gt;getMessageId();</code></pre>
<p>The HTTP request is not actually sent until the properties on <code>$result</code> are accessed.
On the first call to a getter, the HTTP response will be downloaded and the body
will be parsed.</p>
<p>This behavior can be observed when using a debugger like xDebug.</p>
<h3 id="not-using-the-result">Not using the result</h3>
<p>Consider this rare scenario:</p>
<pre><code class="language-php hljs"><span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Sqs</span>\<span class="hljs-title">SqsClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Sqs</span>\<span class="hljs-title">Input</span>\<span class="hljs-title">SendMessageRequest</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendSqsMessage</span><span class="hljs-params">($client)</span> </span>{
    $input = <span class="hljs-keyword">new</span> SendMessageRequest();
    $input
        -&gt;setQueueUrl(<span class="hljs-string">'https://sqs.us-east-2.amazonaws.com/123456789012/invoice'</span>)
        -&gt;setMessageBody(<span class="hljs-string">'invoiceId: 1337'</span>);

    $result = $client-&gt;sendMessage($input);

    <span class="hljs-comment">// 100 lines of business logic</span>
    <span class="hljs-comment">// No line is using $result</span>
}

$sqs = <span class="hljs-keyword">new</span> SqsClient();
sendSqsMessage($sqs);</code></pre>
<p>In this example <code>$result</code> is never used. The HTTP request will be send on <code>$result-&gt;__desctuct()</code>.
But that does not happen until the end of the block, after the 100 lines of business
logic. This can be a bit confusing, especially when an exception is thrown.</p>
<p>This scenario can be solved in a few ways. <strong>Solution A</strong> is the best one to use but
the others are listed as examples.</p>
<h4 id="solution-a">Solution A</h4>
<pre><code class="language-diff hljs"><span class="hljs-deletion">-    $result = $sqs-&gt;sendMessage($input);</span>
<span class="hljs-addition">+    $sqs-&gt;sendMessage($input);</span></code></pre>
<h4 id="solution-b">Solution B</h4>
<pre><code class="language-diff hljs">    $result = $sqs-&gt;sendMessage($input);
<span class="hljs-addition">+   $result-&gt;getMessageId();</span></code></pre>
<h4 id="solution-c">Solution C</h4>
<pre><code class="language-diff hljs">    $result = $sqs-&gt;sendMessage($input);
<span class="hljs-addition">+   unset($result);</span></code></pre>
<h4 id="solution-d">Solution D</h4>
<p>This solution requires some more explanation. See <a href="#using-resolve-function">below</a>
for more information.</p>
<pre><code class="language-diff hljs">    $result = $sqs-&gt;sendMessage($input);
<span class="hljs-addition">+   $result-&gt;resolve();</span></code></pre>
<h2 id="advanced-use-cases">Advanced use cases</h2>
<p>The normal use cases covers 90% of all code. Let's dig in to the advanced stuff.</p>
<h3 id="using-resolve-function">Using resolve-function</h3>
<p>The <code>$result-&gt;resolve()</code> function is making sure the request is executed. There is
normally no point in using this function, but in some scenarios it may be handy.</p>
<p>Calling this function with no arguments will either return <code>true</code> or throw an exception.
If the function is called again, it will give you the same output without contacting
the remote server again.</p>
<p>The function has a <code>?float $timeout = null</code> argument. If the timeout is set to
<code>2.0</code>, the HTTP client will wait for 2 seconds for a response. If a response is received,
the function will return <code>true</code> or thrown an exception. If the timeout is reached,
it will return <code>false</code>.</p>
<blockquote>
<p><strong>Note:</strong> The call <code>$result-&gt;resolve()</code> is a blocking call because we are waiting
for the response. Use <code>$result-&gt;resolve(0)</code> for a non-blocking call.</p>
</blockquote>
<h3 id="batch-requests">Batch requests</h3>
<p>Consider the following example. It is creating 10 Lambda <code>InvocationRequest</code>s and printing
their result. The HTTP response that is downloaded first will be printed first. The order
the requests are created do not matter.</p>
<p>The <code>Result::wait()</code> function will iterate over provided results, and yield
the the response as soon as it has been resolved.</p>
<p>The function has a <code>?float $timeout = null</code> argument. If the timeout is set to
<code>2.0</code>, the HTTP client will wait up to 2 seconds for responses. Each time a response
is received, the function will yield the response. If the timeout is reached, or
all responses are resolved, the loop will stop.</p>
<p>The function has also a <code>$fullResponse</code> argument. When <code>false</code> (default value)
the HTTP client will wait only for HTTP status code and headers. When <code>true</code>,
the HTTP client will wait until receiving the full response body.</p>
<pre><code class="language-php hljs"><span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Core</span>\<span class="hljs-title">Result</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Lambda</span>\<span class="hljs-title">LambdaClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">AsyncAws</span>\<span class="hljs-title">Lambda</span>\<span class="hljs-title">Input</span>\<span class="hljs-title">InvocationRequest</span>;

$lambda = <span class="hljs-keyword">new</span> LambdaClient();

$results = [];
<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>; $i &lt; <span class="hljs-number">10</span>; ++$i) {
    $results[] = $lambda-&gt;invoke(<span class="hljs-keyword">new</span> InvocationRequest([
        <span class="hljs-string">'FunctionName'</span> =&gt; <span class="hljs-string">'app-dev-hello_world'</span>,
        <span class="hljs-string">'Payload'</span> =&gt; <span class="hljs-string">"{\"name\": $i}"</span>,
    ]));
}

<span class="hljs-keyword">foreach</span> (Result::wait($results, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">true</span>) <span class="hljs-keyword">as</span> $result) {
    <span class="hljs-keyword">echo</span> $result-&gt;getPayload();
}</code></pre>
<p>The pseudo code at the lambda function:</p>
<pre><code class="language-php hljs"><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($event)</span> </span>{
    $rand = rand (<span class="hljs-number">1</span>, <span class="hljs-number">4</span>);
    sleep($rand);

    <span class="hljs-keyword">return</span> <span class="hljs-string">'Name '</span> . ($event[<span class="hljs-string">'name'</span>]) . <span class="hljs-string">': '</span> . $rand . <span class="hljs-string">'s'</span>;
};</code></pre>
<p>The output will look like:</p>
<pre><code class="language-text">Name 4: 1s
Name 2: 1s
Name 6: 1s
Name 3: 2s
Name 9: 2s
Name 7: 2s
Name 8: 3s
Name 5: 3s
Name 0: 4s
Name 1: 4s</code></pre>

    </main>
</div>

<script src="/assets/0.cfad5cda.js"></script><script src="/assets/app.e35480ea.js"></script>


</body></html>